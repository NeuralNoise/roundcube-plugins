function calendar_callbacks(){this.setTimeline=function(){var a=$(".fc-agenda-slots:visible").parent(),c=a.children(".timeline");rcmail.env.calendar_timeline=c;0==c.length&&(c=$("<hr>").addClass("timeline"),a.prepend(c));var b=new Date,e=$("#calendar").fullCalendar("getView");e.visStart<b&&e.visEnd>b?c.show():c.hide();b=(3600*b.getHours()+60*b.getMinutes()+b.getSeconds())/86400;a=Math.floor(a.height()*b);c.css("top",a+"px");if("agendaWeek"==e.name||"agendaDay"==e.name){var a=1,b=0,f,i;if("agendaWeek"==
e.name){i=$(".fc-today:visible");try{b=i.position().left,f=i.width()+"px"}catch(g){c.hide()}}"agendaDay"==e.name&&(b=70,a=0,f="100%");0<b&&c.css({left:b+a+"px",width:f})}else c.hide()};this.viewDisplay=function(a,c){var b=$("#calendar").fullCalendar("getDate");wn=b.getWeekOfYearStartMonday(b);var e=new Date(b.getFullYear(),b.getMonth(),1,0,0,0);bds=b.getWeekOfYearStartMonday(e);e=new Date(b.getFullYear(),b.getMonth(),b.getDaysInMonth(),23,59,59);eds=b.getWeekOfYearStartMonday(e);b=bds+" - "+eds;"month"==
a.name&&($("#monthbut").focus(),$("#datepicker-title").html("<center>"+a.title+"</center>"),$("#weeknumber").html("<center>"+c.settings.calendar_week+": "+b+"</center>"));"agendaDay"==a.name&&($("#daybut").focus(),$("#datepicker-title").html("<center>"+a.title+"</center>"),$("#weeknumber").html("&nbsp;"));"agendaWeek"==a.name&&($("#weekbut").focus(),$("#datepicker-title").html("<center>"+a.title+"</center>"),$("#weeknumber").html("<center>"+c.settings.calendar_week+": "+wn+"</center>"));if("agendaWeek"==
a.name||"agendaDay"==a.name){f&&window.clearInterval(f);var f=window.setInterval(calendar_callbacks.setTimeline,1E4);try{calendar_callbacks.setTimeline()}catch(i){}}else rcmail.env.calendar_timeline&&rcmail.env.calendar_timeline.hide()};this.qtip=function(a,c){return c=calendar_common.qtip(a,c)};this.loading=function(a,c){var b=$("#calendar").fullCalendar("getView"),e=(new Date).getTime(),f=b.start.getTime(),b=b.end.getTime();$("#todaybut").attr("title",new Date(e));e<f||e>b?$("#todaybut").prop("disabled",
!1):$("#todaybut").prop("disabled",!0);a?($("#calendaroverlay").show(),c||(c=rcmail.set_busy(!0,"loading")),rcmail.enable_command("plugin.calendar_print",!1)):(rcmail.set_busy(!1,"loading",c),$("#calendaroverlay").hide(),rcmail.env.calpopup&&(rcmail.env.calpopup=calendar_commands.previewPrintEvents()),"show"!=rcmail.env.action&&calendar_commands.triggerSearch());c&&(rcmail.env.calendar_msgid=c);return c};this.eventRender_upcoming=function(a,c,b,e){c=this.qtip(a,c);a.end&&1!=a.allDay?(b=a.end.format(js_time_formats[rcmail.env.rc_time_format]),
c.find(".fc-event-title").html(" - "+b+" "+a.title)):calendar_common.modifyEvents(a,c,b,e);a.onclick&&c.bind("click",function(){})};this.eventRender=function(a,c,b,e){rcmail.enable_command("plugin.calendar_print",!0);""==c.find("span.fc-event-title").html()&&c.find("span.fc-event-title").html("&nbsp;");c=this.qtip(a,c);if("month"!=b.name){if(a.className&&!a.allDay){var f=a.classNameDisp;f||(f=a.className);"null"==f&&(f="");""!=f&&c.find("div.fc-event-title").after('<div class="fc-event-categories">['+
f+"]</div>")}a.location&&c.find("div.fc-event-title").after('<div class="fc-event-location">@'+a.location+"</div>");a.description&&!a.allDay&&(f=a.description,20<f.length&&(f=f.substring(0,20)+" ..."),c.find("div.fc-event-title").after('<div class="fc-event-description">'+f+"</div>"));f=".fc-event-time";if(a.allDay&&(calendar_common.modifyEvents(a,c,b,e),f=".fc-event-title",0!=a.rr))var i=c.find(".fc-event-title").html();0!=a.rr&&(i=c.find(f).html(),c.find(f).html(i+"&nbsp;<img style='padding: 0 1px' src='plugins/calendar/skins/"+
rcmail.env.skin+"/images/recur.png' />"));0!=a.reminderservice&&(i=c.find(f).html(),c.find(f).html(i+"&nbsp;<img style='padding: 0 1px' src='plugins/calendar/skins/"+rcmail.env.skin+"/images/reminder.png' />"))}"month"==b.name&&(a.end&&1!=a.allDay?(b=a.end.format(js_time_formats[rcmail.env.rc_time_format]),c.find(".fc-event-title").html(" - "+b+" "+a.title)):calendar_common.modifyEvents(a,c,b,e));a.onclick&&c.bind("click",function(){})};this.eventDragStart=function(a){rcmail.env.clone_gap=0;rcmail.env.allday_drag=
8634E4<=a.end.getTime()-a.start.getTime()&&864E5>=a.end.getTime()-a.start.getTime()?!0:!1;a.clone&&(rcmail.env.clone_gap=a.start.getTime()/1E3-a.clone);rcmail.env.replication_complete||rcmail.display_message(rcmail.gettext("backgroundreplication","calendar"),"error")};this.eventDrop=function(a,c,b,e,f,i){if(rcmail.env.replication_complete){e&&864E5>=a.end.getTime()-a.start.getTime()&&(a.start=new Date(a.start.getFullYear(),a.start.getMonth(),a.start.getDate(),0,0,0),a.end=new Date(a.start.getFullYear(),
a.start.getMonth(),a.start.getDate(),23,59,0));rcmail.env.allday_drag&&!e&&(a.end=new Date(a.start.getTime()+1E3*rcmail.env.calsettings.settings.duration));rcmail.env.edit_event=a;rcmail.env.edit_dayDelta=c;rcmail.env.edit_minuteDelta=b;rcmail.env.edit_allDay=e;rcmail.env.edit_revertFunc=f;c=0;if(a.clone){if(!rcmail.env.edit_recurring){calendar_commands.edit_recurring_html("move");return}"initial"==rcmail.env.edit_recurring&&(a.start=new Date(a.start.getTime()-1E3*rcmail.env.clone_gap),a.end=new Date(a.end.getTime()-
1E3*rcmail.env.clone_gap),c=1)}0!=a.rr&&(c=1);b=(new Date).getTime();if(a.past&&a.end.getTime()>=b||!a.past&&a.end.getTime()<b){if(a.past&&a.end.getTime()>=b){var g="#"+a.color_save;a.past=!1}!a.past&&a.end.getTime()<b&&(g="#"+lighter(a.backgroundColor,50),a.past=!0);a.color=g;a.backgroundColor=g;a.borderColor=g}g="";rcmail.env.edit_recurring&&(g="&_mode="+rcmail.env.edit_recurring);rcmail.env.clone_gap&&(g=g+"&_gap="+rcmail.env.clone_gap);rcmail.env.edit_recurring=!1;$("#calendaroverlay").show();
msgid=rcmail.set_busy(!0,"loading");rcmail.http_post("plugin.moveEvent","_event_id="+a.id+"&_uid="+a.uid+"&_start="+Math.round(a.start.getTime()/1E3)+"&_end="+Math.round(a.end.getTime()/1E3)+"&_allDay="+e+"&_refetch="+c+"&_reminder="+a.reminder+"&_msgid="+msgid+g);calendar_gui.upcoming(i)}else rcmail.display_message(rcmail.gettext("backgroundreplication","calendar"),"error"),f(a,c,b,e,f,i)};this.eventResizeStop=function(){rcmail.env.replication_complete||(rcmail.display_message(rcmail.gettext("backgroundreplication",
"calendar"),"error"),$("#calendar").fullCalendar("refetchEvents"))};this.eventResize=function(a,c){if(rcmail.env.replication_complete){var b=0;rcmail.env.edit_event=a;rcmail.env.edit_delta=c;if(a.clone){if(!rcmail.env.edit_recurring){calendar_commands.edit_recurring_html("resize");return}"initial"==rcmail.env.edit_recurring&&(b=a.start.getTime()/1E3-a.clone,a.start=new Date(1E3*a.clone),a.end=new Date(a.end.getTime()-1E3*b),b=1)}var e=(new Date).getTime();if(a.past&&a.end.getTime()>=e||!a.past&&a.end.getTime()<
e){if(a.past&&a.end.getTime()>=e){var f="#"+a.color_save;a.past=!1}!a.past&&a.end.getTime()<e&&(f="#"+lighter(a.backgroundColor,50),a.past=!0);a.color=f;a.backgroundColor=f;a.borderColor=f}f="";rcmail.env.edit_recurring&&(f="&_mode="+rcmail.env.edit_recurring);rcmail.env.edit_recurring=!1;$("#calendaroverlay").show();msgid=rcmail.set_busy(!0,"loading");rcmail.http_post("plugin.resizeEvent","_event_id="+a.id+"&_uid="+a.uid+"&_start="+Math.round(a.start.getTime()/1E3)+"&_end="+Math.round(a.end.getTime()/
1E3)+"&_allDay="+a.allDay+"&_reminder="+a.reminder+"&_refetch="+b+"&_msgid="+msgid+f)}else rcmail.display_message(rcmail.gettext("backgroundreplication","calendar"),"error")};this.select=function(a,c,b,e,f,i){this.dayClick(a,b,e,f,i,c)};this.dayClick=function(a,c,b,e,f,i){if(b)if(rcmail.env.replication_complete){$("#catprotected").remove();var g=$("#event");if(!0!==g.dialog("isOpen")){a||(a=new Date(a.getTime()/1E3));i||(i=new Date(1E3*(a.getTime()/1E3+f.settings.duration)));rcmail.env.cal_remindermailto&&
$("#remindermailto").html(rcmail.env.cal_remindermailto);calendar_gui.resetForm(g);calendar_gui.initTabs(2,3);$("#hoursel").attr("checked",!0);calendar_gui.initExpireDatepicker(i,f);calendar_gui.initStartdateDatepicker(a,f);calendar_gui.initEnddateDatepicker(i,f);calendar_gui.initReminderDatepicker(a,f);calendar_gui.reminderControls();var j=$("#summary"),q=$("#description"),o=$("#categories");o||(o="");var k=$("#location"),m=$("#expires"),b=a.getHours()+"";2>b.length&&(b="0"+b);e=a.getMinutes()+"";
2>e.length&&(e="0"+e);b=b+":"+e;c&&"month"!=$("#calendar").fullCalendar("getView").name&&(b="00:00");$("#starttime").val(b);var p=$("#starttime").val(),b=i.getHours()+"";2>b.length&&(b="0"+b);i=i.getMinutes()+"";2>i.length&&(i="0"+i);i=b+":"+i;c&&(i="23:59");$("#endtime").val(i);var s=$("#endtime").val();$("#occurrences").val(0);var u=$("#recursel");u.val(0);calendar_gui.toggleRecur();var t=$("#calimport"),i=rcmail.gettext("save","calendar"),b=rcmail.gettext("cancel","calendar"),e={};e[i]=function(){if(""!=
t.val()&&t.val()!=rcmail.env.cal_lastimport){g.dialog("close");$("#calendaroverlay").show();rcmail.env.calendar_msgid=rcmail.set_busy(!0,"loading");var b=$('<iframe name="uploader" id="uploader" src="" style="width:0;height:0;visibility:hidden;" />');$("body").append(b);$("#form").submit();$("#uploader").load(function(){$("#calendar").fullCalendar("removeEvents");$("#calendar").fullCalendar("refetchEvents");rcmail.set_busy(!1,"loading",rcmail.env.calendar_msgid);$("#calendaroverlay").hide();rcmail.env.cal_lastimport=
t.val();t.val("")});return!1}var b=$.trim($("#starttime").val()),h=$.trim($("#startdate").val()),e=$.trim($("#endtime").val());if(b!=p||e!=s)c=!1;var i=$.trim($("#enddate").val());i+" "+e>m.val()&&m.val(i+" "+e);if(0!=u.val()&&(d=m.val().split(" "),d[0]<=i&&0==$("#occurrences").val()&&confirm(rcmail.gettext("calendar.verifyexpiredate"))))return $("#tab2").trigger("click"),m.val(d[0]),m.focus(),!1;var d=a.getFullYear(),v=a.getMonth()+1+"";2>v.length&&(v="0"+v);var l=a.getDate()+"";2>l.length&&(l="0"+
l);i+" "+e<=d+"-"+v+"-"+l+" "+b&&(e=a.getTime()/1E3+f.settings.duration,e=new Date(1E3*e),b=e.getHours()+"",2>b.length&&(b="0"+b),d=a.getMinutes()+"",2>d.length&&(d="0"+d),e=$("#endtime").val(b+":"+d));var d=$("#starttime").val(),d=d.split(":"),e=d[0],i=d[1],d=$("#endtime").val(),d=d.split(":"),b=d[0],d=d[1],d=h.split("-"),b=new Date(parseFloat(d[0]),parseFloat(d[1])-1,parseFloat(d[2]),parseFloat(e),parseFloat(i),0),h=$("#remindercustom").val(),d=h.split(" "),h=d[0];if(d=d[1])d=d.split(":"),e=d[0],
i=d[1],d=h.split("-"),h=new Date(parseFloat(d[0]),parseFloat(d[1])-1,parseFloat(d[2]),parseFloat(e),parseFloat(i),0),h=(b.getTime()-h.getTime())/1E3,$("#durationcustom").val(h);b=$("#occurrences");""==b.val()&&b.val(0);rrsec=recv=u.val();rrsec=recv.substr(0,1);recv=recv.substr(1);switch(rrsec){case "d":recv*=parseInt($("#dnums").val());break;case "w":recv*=parseInt($("#wnums").val());break;case "m":recv*=parseInt($("#mnums").val());break;case "y":recv*=parseInt($("#ynums").val())}recv=rrsec+recv;
var r="",w=-1,z=0;mydays="SU MO TU WE TH FR SA".split(" ");$("#form input[type=checkbox]").each(function(){w++;if(this.checked){z=w;r=w<7?r+mydays[w]+",":r+(w-6)+","}});r=r.substr(0,r.length-1);h="";6<z?h="&_bymonthday="+r:""!=r&&(h="&_byday="+r);"m"==rrsec?0!=$("xmevery").val()&&0!=$("#mweekday").val()&&(h="&_byday="+$("#mevery").val()+$("#mweekday").val()):"y"==rrsec&&(0!=$("#yevery").val()&&0!=$("yweekday").val()&&(h="&_byday="+$("#yevery").val()+$("#yweekday").val()),0!=$("#ymonth").val()&&(h=
h+"&_bymonth="+$("#ymonth").val()),0!=$("#ydnums").val()&&0!=$("#ymonthday").val()&&(h=h+"&_bymonthday="+$("#ydnums").val()+"&_bymonth="+$("#ymonthday").val()));$("#calendaroverlay").show();msgid=rcmail.set_busy(!0,"loading");for(0==recv&&$("#occurrences").val(0);-1<j.val().indexOf("?");)j.val(j.val().replace("?","%3F"));for(;-1<q.val().indexOf("?");)q.val(q.val().replace("?","%3F"));for(;-1<k.val().indexOf("?");)k.val(k.val().replace("?","%3F"));for(;-1<j.val().indexOf("&");)j.val(j.val().replace("&",
"%26"));for(;-1<q.val().indexOf("&");)q.val(q.val().replace("&","%26"));for(;-1<k.val().indexOf("&");)k.val(k.val().replace("&","%26"));rcmail.http_post("plugin.newEvent",$("#form").serialize()+"&_summary="+j.val()+"&_description="+q.val()+"&_location="+k.val()+"&_categories="+o.val()+"&_allDay="+c+"&_occurrences="+b.val()+"&_recur="+recv+h+"&_msgid="+msgid);g.dialog("close");rcmail.env.cal_search_string=""};e[b]=function(){g.dialog("close")};g.dialog({modal:!1,width:630,position:"center",zIndex:5001,
title:rcmail.gettext("new_event","calendar"),close:function(){g.dialog("destroy");g.hide()},buttons:e}).show();$("#summary").focus()}}else rcmail.display_message(rcmail.gettext("backgroundreplication","calendar"),"error")};this.eventClick=function(a,c){if(a.editable&&!rcmail.env.replication_complete&&"false"==queryString("_event_id"))rcmail.display_message(rcmail.gettext("backgroundreplication","calendar"),"error");else if(a.onclick)-1<a.onclick.indexOf("?_task=mail&_action=compose")?"function"==
typeof opencomposewindow?opencomposewindow(a.onclick):window.open(a.onclick):window.open(a.onclick);else{rcmail.env.edit_event=a;if(a.clone&&a.editable){if(!rcmail.env.edit_recurring){calendar_commands.edit_recurring_html("edit");return}switch(rcmail.env.edit_recurring){case "initial":if(a.initial){a=a.initial;a.start=new Date(1E3*a.start_unix);var b=0;a.allDay&&(b=parseInt(a.start.getTimezoneOffset()));a.start=new Date(1E3*(parseInt(a.start_unix)+60*b));a.end&&(a.end=new Date(1E3*a.end_unix),b=0,
a.allDay&&(b=parseInt(a.end.getTimezoneOffset())),a.end=new Date(1E3*(parseInt(a.end_unix)+60*b)));rcmail.env.edit_recurring=!1;$("#calendaroverlay").hide();$("#calendaroverlay").html("")}else{calendar_commands.gotoDate(a.clone,a.id);return}break;case "single":var e=a.start_unix;break;case "future":a.occurrences=Math.max(0,a.occurrences-a.hasoccurred)}}a.end||(a.end=new Date(a.start.getTime()+1E3*c.settings.duration));var f=$("#event");calendar_gui.resetForm(f);calendar_gui.initTabs(3,2);b=a.start;
calendar_gui.initExpireDatepicker(a.start,c);calendar_gui.initStartdateDatepicker(a.start,c);calendar_gui.initEnddateDatepicker(a.start,c);calendar_gui.initReminderDatepicker(a.start,c);shour=b.getHours()+"";2>shour.length&&(shour="0"+shour);sminute=b.getMinutes()+"";2>sminute.length&&(sminute="0"+sminute);$("#starttime").val(shour+":"+sminute);var i=$("#starttime").val(),g=a.end;ehour=g?g.getHours()+"":"0";2>ehour.length&&(ehour="0"+ehour);eminute=g?g.getMinutes()+"":"0";2>eminute.length&&(eminute=
"0"+eminute);b=g.getDate()+"";2>b.length&&(b="0"+b);var j=g.getMonth()+1+"";2>j.length&&(j="0"+j);g=g.getFullYear()+"";$("#enddate").val(g+"-"+j+"-"+b);$("#endtime").val(ehour+":"+eminute);var q=$("#endtime").val(),o=$("#summary").val(a.title),k=$("#description").val(a.description),m=$("#location").val(a.location),p=$("#categories"),s=a.classNameDisp;a.classNameICS&&(s=a.classNameICS);s||(s=a.className);""!=s?p.val(s):p.prop("selectedIndex",0);a.classProtected&&a.editable?(p.prop("disabled",!0),$("#catprotected").remove(),
p.parent().append('<span id="catprotected">&nbsp;<i>('+rcmail.gettext("calendar.protected")+")</i></span>")):$("#catprotected").remove();var u=p.val(),b=(new Date(1E3*(parseInt(a.expires)+3600*parseInt((new Date(a.start)).getTimezoneOffset()/60)))).format("yyyy-MM-dd"),t=$("#expires").val(b),x=$("#occurrences").val(a.occurrences);$("#export_as_file").attr("href","./?_task=dummy&_action=plugin.calendar_single_export_as_file&_id="+a.id+"&_edit="+a.editable);$("#send_invitation").attr("href","./?_task=dummy&_action=plugin.calendar_send_invitation&_id="+
a.id+"&_edit="+a.editable);var h=!1;switch(a.rr){case "d":h=86400;break;case "w":h=604800;break;case "m":h=2592E3;break;case "y":h=31536E3}var y=$("#recursel");a.recur&&0!=a.recur&&h&&y.val(a.rr+h);calendar_gui.toggleRecur("recursel");if(rrsec=h=y.val())rrsec=h.substr(0,1),h=h.substr(1);b=[];b.SU=0;b.MO=1;b.TU=2;b.WE=3;b.TH=4;b.FR=5;b.SA=6;j=a.byday.split(",");switch(rrsec){case "d":$("#dnums").val(parseInt(a.recur)/86400);break;case "w":$("#wnums").val(parseInt(a.recur)/604800);if(0!=a.byday){calendar_gui.currentStyle("byweekdayslink")&&
$("#byweekdayslink").click();for(var g=document.forms.form,n=0;n<g.elements.length&&"checkbox"!=g.elements[n].type;n++);for(var d=0;d<j.length;d++)if(void 0!=typeof b[j[d]])try{g.elements[n+b[j[d]]].checked=!0}catch(v){}}break;case "m":$("#mnums").val(parseInt(a.recur)/2592E3);if(0!=a.bymonthday){calendar_gui.currentStyle("bymonthdayslink")&&$("#bymonthdayslink").click();j=a.bymonthday.split(",");g=document.forms.form;for(n=0;n<g.elements.length&&"checkbox"!=g.elements[n].type;n++);for(d=0;d<j.length;d++)0<
j[d]&&(g.elements[n+7+parseInt(j[d])].checked=!0)}0!=a.byday&&(calendar_gui.currentStyle("byweekdaylink")&&$("#byweekdaylink").click(),$("#mweekday").val(a.byday.substr(a.byday.length-2)),$("#mevery").val(a.byday.substr(0,a.byday.length-2)));break;case "y":if($("#ynums").val(parseInt(a.recur)/31536E3),0!=a.bymonthday&&0!=a.bymonth&&(calendar_gui.currentStyle("bymonthdaylink")&&$("#bymonthdaylink").click(),$("#ydnums").val(a.bymonthday),$("#ymonthday").val(a.bymonth)),0!=a.byday&&0!=a.bymonth&&0==
a.bymonthday)calendar_gui.currentStyle("byyeardaylink")&&$("#byyeardaylink").click(),$("#yweekday").val(a.byday.substr(a.byday.length-2)),$("#yevery").val(a.byday.substr(0,a.byday.length-2)),$("#ymonth").val(a.bymonth)}if(0!=a.reminderservice)switch($("#reminderenable").attr("checked",!0),a.reminderservice){case "email":$("#remindertype").prop("selectedIndex",0);$("#remindermailto").prop("disabled",!1);break;case "popup":$("#remindertype").prop("selectedIndex",1),$("#remindermailto").prop("disabled",
!0)}else $("#reminderdisable").attr("checked",!0);a.remindermailto&&(b=a.remindermailto,0<$('#remindermailto option[value="'+b+'"]').length?("caldav"==rcmail.env.cal_backend&&(rcmail.env.cal_remindermailto=$("#remindermailto").html(),$("#remindermailto").html('<option value="'+a.remindermailto+'">'+a.remindermailto+"</option>")),$("#remindermailto").val(b)):0!=a.remindermailto&&(j=$("#remindermailto").html(),j=j+'<option value="'+a.remindermailto+'">'+a.remindermailto+"</option>\r\n",$("#remindermailto").html(j),
$("#remindermailto").val(b)));if(0<a.reminder){if(j=!0,1<=a.reminder/604800?(b=a.reminder/604800,b==Math.round(b)&&0<$("#reminderweeksbefore option[value="+b+"]").length&&($("#weeksel").attr("checked",!0),$("#reminderweeksbefore").val(b),j=!1)):1<=a.reminder/86400?(b=a.reminder/86400,b==Math.round(b)&&0<$("#reminderdaysbefore option[value="+b+"]").length&&($("#daysel").attr("checked",!0),$("#reminderdaysbefore").val(b),j=!1)):1<=a.reminder/3600?(b=a.reminder/3600,b==Math.round(b)&&0<$("#reminderhoursbefore option[value="+
b+"]").length&&($("#hoursel").attr("checked",!0),$("#reminderhoursbefore").val(b),j=!1)):1<=a.reminder/60&&(b=a.reminder/60,b==Math.round(b)&&0<$("#reminderminutesbefore option[value="+b+"]").length&&($("#minsel").attr("checked",!0),$("#reminderminutesbefore").val(b),j=!1)),j){$("#customreminder").attr("checked",!0);var l=new Date(a.start.getTime()-1E3*a.reminder),b=l.getFullYear(),j=l.getMonth()+1+"";2>j.length&&(j="0"+j);g=l.getDate()+"";2>g.length&&(g="0"+g);d=l.getHours()+"";2>d.length&&(d="0"+
d);l=l.getMinutes()+"";2>l.length&&(l="0"+l);$("#remindercustom").val(b+"-"+j+"-"+g+" "+d+":"+l)}}else $("#hoursel").attr("checked",!0);calendar_gui.reminderControls();rcmail.env.event_initial=$("#form").serialize();b=rcmail.gettext("save","calendar");j=rcmail.gettext("remove","calendar");g=rcmail.gettext("cancel","calendar");d={};a.editable||"undefined"==typeof a.editable?(d[b]=function(){if(rcmail.env.event_initial==$("#form").serialize()){$("#rcmrow"+a.id).removeClass("selected");$("#rcmmatch"+
a.id).removeClass("calsearchmatchselected");$("#rcmmatch"+a.id).addClass("calsearchmatch")}else{a.title=o.val();a.description=k.val();a.location=m.val();a.className=p.val();var b=$.trim($("#starttime").val()),c=$.trim($("#endtime").val());if(b!=i||c!=q)a.allDay=false;var c=$("#starttime").val(),c=c.split(":"),b=c[0],d=c[1],c=$("#endtime").val();c.split(":");startdate=$("#startdate").val();c=startdate.split("-");b=new Date(parseFloat(c[0]),parseFloat(c[1])-1,parseFloat(c[2]),parseFloat(b),parseFloat(d),
0);c=$("#endtime").val();d=$("#enddate").val();d+" "+c>t.val()+" "+$("#starttime").val()&&t.val(d+" "+c);c=$("#remindercustom").val();c=c.split(" ");d=c[0];if(c=c[1]){var c=c.split(":"),g=c[0],j=c[1],c=d.split("-"),c=new Date(parseFloat(c[0]),parseFloat(c[1])-1,parseFloat(c[2]),parseFloat(g),parseFloat(j),0),c=(b.getTime()-c.getTime())/1E3;$("#durationcustom").val(c)}t.val().split("-");x.val()==""&&x.val(0);b="";$("#categories").val()&&(b=b+"&_categories="+p.val());a.token&&(b=b+"&_ct="+a.token);
a.userid&&(b=b+"&_userid"+a.userid);rrsec=h=y.val();rrsec=h.substr(0,1);h=h.substr(1);switch(rrsec){case "d":h=h*parseInt($("#dnums").val());break;case "w":h=h*parseInt($("#wnums").val());break;case "m":h=h*parseInt($("#mnums").val());break;case "y":h=h*parseInt($("#ynums").val())}h=rrsec+h;c=document.forms.form;d="";g=-1;j=0;mydays=["SU","MO","TU","WE","TH","FR","SA"];for(n=0;n<c.elements.length;n++)if(c.elements[n].type=="checkbox"){g++;if(c.elements[n].checked==true){j=g;d=g<7?d+mydays[g]+",":
d+(g-6)+","}}d=d.substr(0,d.length-1);j>6?b="&_bymonthday="+d:d!=""&&(b="&_byday="+d);if(rrsec=="m")$("#mevery").val()!=0&&$("#mweekday").val()!=0&&(b="&_byday="+$("#mevery").val()+$("#mweekday").val());else if(rrsec=="y"){$("#yevery").val()!=0&&$("#yweekday").val()!=0&&(b="&_byday="+$("#yevery").val()+$("#yweekday").val());$("#ymonth").val()!=0&&(b=b+"&_bymonth="+$("#ymonth").val());$("#ydnums").val()!=0&&$("#ymonthday").val()!=0&&(b=b+"&_bymonthday="+$("#ydnums").val()+"&_bymonth="+$("#ymonthday").val())}$("#calendaroverlay").show();
msgid=rcmail.set_busy(true,"loading");c=0;rcmail.env.recurselnever&&(c=1);h==0&&$("#occurrences").val(0);d=0;s!=p.val()&&(d=1);a.recurrence_id&&(b=b+"&_recurrence_id="+a.recurrence_id);e&&(b=b+"&_recurrence_id="+e);for(rcmail.env.edit_recurring&&(b=b+"&_mode="+rcmail.env.edit_recurring);o.val().indexOf("?")>-1;)o.val(o.val().replace("?","%3F"));for(;k.val().indexOf("?")>-1;)k.val(k.val().replace("?","%3F"));for(;m.val().indexOf("?")>-1;)m.val(m.val().replace("?","%3F"));for(;o.val().indexOf("&")>
-1;)o.val(o.val().replace("&","%26"));for(;k.val().indexOf("&")>-1;)k.val(k.val().replace("&","%26"));for(;m.val().indexOf("&")>-1;)m.val(m.val().replace("&","%26"));rcmail.http_post("plugin.editEvent",$("#form").serialize()+"&_event_id="+a.id+"&_uid="+a.uid+"&_summary="+o.val()+"&_description="+k.val()+"&_location="+m.val()+"&_categories="+p.val()+"&_old_categories="+u+"&_allDay="+a.allDay+"&_occurrences="+x.val()+"&_recur="+h+b+"&_recurselnever="+c+"&_reload="+d+"&_edit=1&_msgid="+msgid+b);rcmail.env.cal_search_string=
""}f.dialog("close")},d[j]=function(){var b="";rcmail.env.edit_recurring&&(b="&_mode="+rcmail.env.edit_recurring);$("#rcmrow"+a.id).remove();$("#calendaroverlay").show();msgid=rcmail.set_busy(true,"loading");rcmail.http_post("plugin.removeEvent","_event_id="+a.id+"&_start="+a.start_unix+"&_msgid="+msgid+"&_uid="+a.uid+b);$("#calendar").fullCalendar("removeEvents",a.id);$("#upcoming").fullCalendar("removeEvents",a.id);f.dialog("close");rcmail.env.cal_search_string="";calendar_commands.triggerSearch()}):
$("input, textarea, select","#form").each(function(){$(this).prop("disabled",true);$("#event").tabs("disable",1);$("#event").tabs("disable",3);$("#event").tabs("disable",4)});d[g]=function(){$("#rcmrow"+a.id).removeClass("selected");$("#rcmmatch"+a.id).removeClass("calsearchmatchselected");$("#rcmmatch"+a.id).addClass("calsearchmatch");f.dialog("close")};f.dialog({modal:!1,title:rcmail.gettext("edit_event","calendar"),width:630,zIndex:5001,position:"center",close:function(){f.dialog("destroy");f.hide();
rcmail.env.edit_recurring=false},buttons:d}).show();$("#summary").focus()}}}calendar_callbacks=new calendar_callbacks;